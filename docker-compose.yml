version: '2.2'

volumes:
  reports-data:
    driver: "local"
  django-data:
    driver: "local"
  redis-data:
    driver: "local"
  s3-data:
    driver: "local"

services:

  redis:
    image: library/redis:6-alpine
    volumes:
    - "redis-data:/data"

  prospect:
    build: ./insight
    volumes:
      - "django-data:/database"
      - "./insight:/insight"
    environment:
      - "SECRET_KEY=6tdp62idf"
    depends_on:
      - 'redis'

  lighthouse:
    build: ./lighthouse
    init: true
    volumes:
    - "reports-data:/home/chrome/reports"
    command:
      - "worker"
      - "-u"
      - "redis://redis:6379"
    shm_size: "1gb"
    depends_on:
      - 'redis'

  nginx:
    build:
      context: './nginx'
    volumes:
      - './nginx/config:/etc/nginx'
      - './nginx/static:/static'
      - "reports-data:/reports"
    depends_on:
      - 'prospect'
    ports:
    - "80:80"

  minio:
    image: minio/minio
    volumes:
    - "s3-data:/data"
    command:
      - "server"
      - "/data"
    ports:
    - "9000:9000"
    environment:
    - "MINIO_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE"
    - "MINIO_SECRET_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
